apiVersion: v1
kind: Pod
metadata:
  name: spark-tekton-demo-{{ run_id }}
  labels:
    spark-app-id: '{{ run_id }}'
spec:
  metadata:
    name: spark-app
  restartPolicy: Never
  containers:
    - name: spark-app
      image: spark-tekton-demo:latest
      resources:
        limits:
          cpu: '1'
          memory: 2Gi
        requests:
          cpu: '1'
          memory: 1Gi
      env:
        - name: S2I_SPARK_CLUSTER
          value: ephemeral
        - name: S2I_SPARK_RUN_ID
          value: '{{ run_id }}'
---
apiVersion: v1
kind: Service
metadata:
  name: spark-tekton-demo-{{ run_id }}
spec:
  selector:
    spark-app-id: '{{ run_id }}'
  clusterIP: None
  type: ClusterIP
  sessionAffinity: None
